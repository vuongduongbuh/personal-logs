<template>
    <input type="file" files.bind="newFeed.selectedFiles" 
            accept="image/*" change.delegate="newFeed.isFileSelected=true" class="pl-input--files pl-input--files--new">
    <input type="file" files.bind="newConnector.selectedFiles" accept="image/*" change.delegate="newConnector.isFileSelected=true"
        class="pl-input--files pl-input--files--connect">
        <input type="file" files.bind="editedFeed.selectedFiles" accept="image/*" change.delegate="editedFeed.isFileSelected=true"
            class="pl-input--files pl-input--files--edit">

    <div class="pl-container">
        <div class="pl-header pl-header--feed">
            <div>
                <img class="pl-icon pl-icon--user" src="./assets/img/icon-user.png">
                <button type="button" class="btn btn-primary" click.trigger="search()">
            <span class="glyphicon glyphicon-search"></span> 
            Search
        </button>
            </div>
            <button type="button" class="btn btn-primary" click.delegate="isInputOnFocus = true">Compose</button>
        </div>

        <div class="pl-feed">
            <div class="pl-feed__compose">
                <div class="pl-feed__compose--on-blur" click.delegate="isInputOnFocus = true" show.bind="!isInputOnFocus">
                    <span>What's on your mind?</span>
                </div>

                <div class="pl-feed__compose--on-focus" show.bind="isInputOnFocus">
                    <textarea maxLength="250" value.bind="newFeed.rawText" rows="3" placeholder="Start typing..." class="pl-input"> </textarea>

                    <div class="pl-feed__compose--actions">
                        <div>
                            <a click.trigger="triggerClickInputFiles('new')" show.bind="!newFeed.isFileSelected">
                                <img class="pl-icon pl-icon--user" src="./assets/img/icon-camera.png">
                            </a>
                            <a click.trigger="removeSelectedFile(newFeed)" show.bind="newFeed.isFileSelected">
                                <span class="glyphicon glyphicon-remove"></span> Remove image
                            </a>
                        </div>

                        <div>
                            <h4>${newFeedLength}</h4>
                            <button type="button" class="btn btn-primary ladda-button pl-btn--done" data-style="zoom-out" click.delegate="postNewFeed()"
                                disabled.bind="!newFeed.rawText.trim()">Done</button>
                        </div>
                    </div>

                </div>
            </div>

            <div repeat.for="feed of feeds">
                <div class="pl-feed__connector pl-feed__connector--front" show.bind="feed.connectTo">
                </div>

                <div class="pl-feed__feed ${isFeedHovered ? 'pl-feed__feed--on-hover': ''}" mouseover.delegate="isFeedHovered = true" mouseout.delegate="isFeedHovered = false"
                    show.bind="!feed.isEdited">
                    <div class="pl-feed__feed--content">
                        <span show.bind="!feed.url">${feed.text} </span>
                        <a if.bind="feed.url" href.bind="feed.url" target="_blank">${feed.text} </a>
                    </div>

                    <div class="pl-feed__feed--image" if.bind="feed.media">
                        <img class="pl-feed__feed--img" width="650" src="${assetsUrl + feed.media}">
                    </div>

                    <div class="pl-feed__feed--tag">
                        <span repeat.for="tag of feed.hashTags">${tag}</span>
                    </div>

                    <div class="pl-feed__feed--time" show.bind="!isFeedHovered">
                        <span>${feed.createdAt}</span>
                    </div>

                    <div class="pl-feed__feed--actions" show.bind="isFeedHovered">
                        <a click.trigger="openConnectionToAFeed(feed)" show.bind="!feed.hasConnection"><span class="glyphicon glyphicon-plus"></span></a>
                        <!--<a click.trigger="showModalConfirmDelete(feed, $index)"><span class="glyphicon glyphicon-option-horizontal"></span></a>
                        <a click.trigger="showEditedFeed(feed, $index)"><span class="glyphicon glyphicon-option-horizontal"></span></a>-->

                        <a class="btn-tooltip" data-tooltip-content="${'.' + feed.id}"><span class="glyphicon glyphicon-option-horizontal"></span></a>

                        <div class="tooltip_templates" style="display: none">
                            <div class="${feed.id}">
                                <a click.trigger="showEditedFeed(feed, $index)">Edit</a>
                                <a click.trigger="showModalConfirmDelete(feed, $index)">Delete</a>
                            </div>
                        </div>

                    </div>
                </div>

                <div class="pl-feed__compose pl-feed__compose--connector" show.bind="feed.isEdited">
                    <div class="pl-feed__compose--on-focus">
                        <textarea maxLength="250" value.bind="editedFeed.rawText" rows="3" placeholder="Start typing..." class="pl-input"> </textarea>

                        <div class="pl-feed__compose--actions">
                            <div>
                                <a click.trigger="triggerClickInputFiles('edit')" show.bind="!editedFeed.isFileSelected">
                                    <img class="pl-icon pl-icon--user" src="./assets/img/icon-camera.png">
                                </a>
                                <a click.trigger="removeSelectedFile(editedFeed)" show.bind="editedFeed.isFileSelected">
                                    <span class="glyphicon glyphicon-remove"></span> Remove image
                                </a>
                            </div>

                            <div>
                                <h4>${newEditedFeedLength}</h4>
                                <button type="button" class="btn btn-primary ladda-button pl-btn--done" data-style="zoom-out" click.delegate="updateFeed(feed, $index)"
                                    disabled.bind="!editedFeed.rawText.trim()">Done
                                    </button>
                            </div>
                        </div>

                    </div>
                </div>

                <div class="pl-feed__connector" show.bind="feed.isConnectionOpened">
                </div>

                <div class="pl-feed__compose pl-feed__compose--connector" show.bind="feed.isConnectionOpened">
                    <div class="pl-feed__compose--on-focus">
                        <textarea maxLength="250" value.bind="newConnector.rawText" rows="3" placeholder="Keep typing..." class="pl-input"> </textarea>

                        <div class="pl-feed__compose--actions">
                            <div>
                                <a click.trigger="triggerClickInputFiles('connect')" show.bind="!newConnector.isFileSelected">
                                    <img class="pl-icon pl-icon--user" src="./assets/img/icon-camera.png">
                                </a>
                                <a click.trigger="removeSelectedFile(newConnector)" show.bind="newConnector.isFileSelected">
                                    <span class="glyphicon glyphicon-remove"></span> Remove image
                                </a>
                            </div>

                            <div>
                                <h4>${newConnectorLength}</h4>
                                <button type="button" class="btn btn-primary ladda-button pl-btn--done" data-style="zoom-out" click.delegate="postNewConnector(feed, $index)"
                                    disabled.bind="!newConnector.rawText.trim()">Done</button>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</template>